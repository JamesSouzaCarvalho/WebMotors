function getSessionId(e, n) { for (var o = document.cookie.split(";"), t = 0; t < o.length; ++t) { var a = o[t].trim().split("="); a[0].toLowerCase().indexOf("sessionid") > 0 && getIpServer(e, n, a[1]) } getIpServer(e, n, "") } function getIpServer(e, n, o) { fetch("https://api.ipify.org/?format=json").then(e => e.json()).then(t => EnviarLog(e, n, o, t.ip)) } function getIpLocal(e) { var n = window.webkitRTCPeerConnection || window.mozRTCPeerConnection; n && function () { var o = new n({ iceServers: [{ urls: "stun:stun.l.google.com:19302" }] }); o.createDataChannel("", { reliable: !1 }), o.onicecandidate = function (e) { e.candidate && i("a=" + e.candidate.candidate) }, o.createOffer(function (e) { i(e.sdp), o.setLocalDescription(e) }, function (e) { console.warn("offer failed", e) }); var t = Object.create(null); function a(n) { if (!(n in t)) { t[n] = !0; var o = Object.keys(t).filter(function (e) { return t[e] }); getSessionId(e, o.join(" or perhaps ") || "n/a") } } function i(e) { e.split("\r\n").forEach(function (e) { if (~e.indexOf("a=candidate")) { var n = (o = e.split(" "))[4]; "host" === o[7] && a(n) } else if (~e.indexOf("c=")) { var o; a(n = (o = e.split(" "))[2]) } }) } t["0.0.0.0"] = !1 }() } function EnviarLog(e, n, o, t) { var a = { Site: "", SessionId: o, ClienteIP: n, IPRemoto: "", ServidorIP: t, ClienteUrl: window.location.href, ServidorUrl: "", Pagina: window.location.pathname, Evento: e }; $.ajax({ type: "POST", url: "/Log/GravarLog", data: a, success: function (e) { $(".preloader").addClass("loaded"), null != e.status && console.log(e.status) }, error: function (e) { console.log("Falha ao gravar log.") }, beforeSend: function () { } }) } function GravarLog(e) { getIpLocal(e) } String.prototype.replaceAll = function (e, n) { return this.replace(new RegExp(e, "g"), n) }, $(document).ready(function () { var e = document.location.pathname.replaceAll("/", ""); "" == e && (e = "Home"), GravarLog(e) });